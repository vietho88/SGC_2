{% load static %}
<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="shortcut icon" href="{% static 'public/images/favicon.ico' %}" type="image/x-icon">
    <link rel="stylesheet" href="{% static 'vendor/bootstrap/css/bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'vendor/selectpicker/css/bootstrap-select.min.css' %}">
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="{% static 'vendor/fontawesome/css/all.min.css' %}">
    <link rel="stylesheet" href="{% static 'vendor/iviewer/jquery.iviewer.css' %}">
    <link rel="stylesheet" href="{% static 'vendor/iviewer/css-viewer.css' %}">
    <link rel="stylesheet" href="{% static 'vendor/DataTables/css/dataTables.bootstrap4.min.css' %}">
    <link rel="stylesheet" href="{% static 'vendor/datepicker/css/bootstrap-datepicker.min.css' %}">
    <link rel="stylesheet" href="{% static 'public/css/base.css' %}?v={%now 'd/m/y/f'/%}">
    <title>Document</title>
    {% block add_css %}
    {% endblock %}
</head>
<body>
<div class="roud-waiting-load-page">
</div>

<div class="waiting-load-page">
    <div class="container">
        <div class="spinner">

        </div>
    </div>
</div>
<header>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark navbar-right">
        {% comment %} <a class="navbar-brand" href="{% url 'home' %}"><img src="{% static 'public/images/logo2.png' %}" style="max-height:25px;width:50px"></a> {% endcomment %}
        <a class="navbar-brand" href="{% url 'home_bill' %}"><img src="{% static 'public/images/logo_home.jpg' %}" style="width: 30px; height: 30px"> SAIGON CO.OP</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <ul class="navbar-nav mr-auto">
            <li class="nav-item active">
                <a class="nav-link" href="#">{% block name_cus %} {% endblock %}  <span class="sr-only">(current)</span></a>
            </li>
        </ul>
        <div class="collapse navbar-collapse" id="navbarNavDropdown">
            <ul class="navbar-nav mr-auto">
                {% if 'Xem hóa đơn' in request.session.list_per %}
                    {% block active_header_bill %}
                    <li class="nav-item ">
                        <a class="nav-link" href="{% url 'home_bill' %}" target="">Hóa Đơn <span class="sr-only">(current)</span></a>
                    </li>
                    {% endblock %}
                {% endif %}
                {% if 'Xem bảng kê' in request.session.list_per %}
                    {% block active_header_invoice_list %}
                    <li class="nav-item ">
                        <a class="nav-link" href="{% url 'home_invoice_list' %}" target="">Bảng Kê <span class="sr-only">(current)</span></a>
                    </li>
                    {% endblock %}
                {% endif %}
{#                {% if 'Xem hóa đơn' in request.session.list_per %}#}
                    {% block active_header_statistical %}
                    <li class="nav-item ">
                        <a class="nav-link" href="{% url 'statistical' %}" target="">Thống kê <span class="sr-only">(current)</span></a>
                    </li>
                    {% endblock %}
{#                {% endif %}#}
                {% if request.user.cus.ttpp == 1 %}
                {% block active_header_excute_report %}
                <li class="nav-item ">
                    <a class="nav-link" href="{% url 'home_warehouse' %}" target="_blank">Xử lí biên bản<span class="sr-only">(current)</span></a>
                </li>
                {% endblock %}
                {% endif %}
            </ul>
            <ul class="navbar-nav ml-auto">

            </ul>
            <ul class="navbar-nav ml-auto">
                <li class="nav-item ">
                    <a class="nav-link active" href="#">{% if not request.user.is_superuser %} Đơn vị {{request.user.cus.name}} |{% endif %}  Vai trò: {{ request.user.role }}</a>
                </li>
                <li class="nav-item dropdown ">
                    <a class="nav-link dropdown-toggle text-white" href="#" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                         <i class="far fa-user"></i> {{ request.user.username }}
                    </a>
                    <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdownMenuLink">
{#                        <a class="dropdown-item" href="#"><i class="far fa-user-circle"></i> Thông tin cá nhân</a>#}
                        {% if request.user.is_superuser  %}
                            <a class="dropdown-item" href="{% url 'admin' %}"><i class="far fa-user-circle"></i> Đi tới trang Admin</a>
                        {% endif %}
                        {% if request.user.is_take_photo %}
                            <a class="dropdown-item" href="#" id="clear_mac" title="Xóa địa chỉ Mac sẽ giúp bạn đăng nhập ở máy điện thoại khác"> <i class="fas fa-trash-alt  "></i> Xóa địa chỉ MAC </a>
                        {% endif %}
                        <a class="dropdown-item" type="button" data-toggle="modal" data-target="#modal-change-pass"><i class="fas fa-key" ></i> Đổi mật khẩu</a>
                        <a class="dropdown-item btn-logout" type="button"><i class="fas fa-sign-out-alt"></i> Đăng xuất</a>
                    </div>
                </li>
            </ul>
        </div>
    </nav>
</header>

<div class="container-fluid">
    <nav aria-label="breadcrumb ">
        <ol class="breadcrumb">
            {% block breadcrumb %}
                <li class="breadcrumb-item"><a href="#">Hóa đơn</a></li>
                <li class="breadcrumb-item"><a href="#">Xem hóa đơn</a></li>
                <li class="breadcrumb-item active" aria-current="page">Data</li>
            {% endblock %}

        </ol>
    </nav>
    
    {% block body %}

    {% endblock %}


    <!-- Modal Change Password-->
    <div class="modal fade" id="modal-change-pass" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalCenterTitle">Thay đổi mật khẩu</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="alert-danger alert-error-change-pass alert-dismissible">
                        
                        {% comment %} <strong>danger</strong> {% endcomment %}
                    </div>
                    <form id="form_change_pass">
                        {% csrf_token %}
                        <div class="form-group">
                            <label for="">Nhập mật khẩu cũ (<i class="fas fa-asterisk" style="color:red;width:8px"></i>)</label>
                            <input type="Password" name="pass_old"  class="form-control" placeholder="" aria-describedby="helpId">
                        </div>
                        <div class="form-group">
                            <label for="">Nhập mật khẩu mới (<i class="fas fa-asterisk" style="color:red;width:8px"></i>)</label>
                            <input type="Password" name="pass_new" class="form-control" placeholder="" aria-describedby="helpId">
                            <small id="emailHelp" class="form-text text-muted">Mật khẩu mới phải lớn hơn hoặc bằng 6 ký tự.</small>
                        </div>
                        <div class="form-group">
                            <label for="">Xác nhận mật khẩu (<i class="fas fa-asterisk" style="color:red;width:8px"></i>)</label>
                            <input type="Password" name="pass_new_repeat"  class="form-control" placeholder="" aria-describedby="helpId">
                            <small id="emailHelp" class="form-text text-muted">Xác nhận mật khẩu phải giống với mật khẩu mới .</small>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-info btn-change-pass">Lưu <i class="fas fa-save  "></i></button>
                    <button type="button" class="btn btn-danger" data-dismiss="modal">Hủy <i class="fas fa-ban  "></i></button>
                </div>
            </div>
        </div>
    </div>

    <script src="{% static 'vendor/jquery-3.5.1.min.js' %}"></script>
    <script src="{% static 'vendor/bootstrap/js/bootstrap.min.js' %}"></script>
    <script src="{% static 'vendor/selectpicker/js/bootstrap-select.min.js' %}"></script>
   <script src="{% static 'vendor/fontawesome/js/all.min.js' %}"></script>
    <script src="{% static 'vendor/sweetalert2.all.min.js' %}"></script>
    <script src="{% static 'vendor/iviewer/jquery-ui.js' %}"></script>
    <script src="{% static 'vendor/iviewer/jquery.mousewheel.min.js' %}"></script>
    <script src="{% static 'vendor/iviewer/jquery.iviewer.js' %}"></script>
    <script src="{% static 'vendor/iviewer/jquery-viewer.js' %}"></script>
    <script src="{% static 'vendor/DataTables/js/jquery.dataTables.min.js' %}"></script>
    <script src="{% static 'vendor/DataTables/js/dataTables.bootstrap4.min.js' %}"></script>
    <script src="{% static 'vendor/datepicker/js/bootstrap-datepicker.min.js' %}"></script>
    <script src="{% static 'vendor/datepicker/locales/bootstrap-datepicker.vi.min.js' %}"></script>
    <script src="{% static 'public/js/base.js' %}"></script>
    <script src="{% static 'public/js/jquery.ba-throttle-debounce.js' %}"></script>
    <script>
        $(document).ready(function () {
            if ('{{ request.session.required_change_path }}' == 'True'){
                alertSwalTopRight('warning', 'Bạn hãy thay đổi mật khẩu mặc định, Xin cảm ơn!')
            }
            $('#clear_mac').on('click', function () {
                $.ajax({
                    url : '{% url 'ajax_clear_mac' %}',
                    type : 'POST',
                    processData: false,
                    contentType: false,
                    csrfmiddlewaretoken : '{{ csrf_token  }}',
                    success : function (data) {
                        if(data.message == 'clear_done'){
                            swal.fire({
                                icon: 'success',
                                title: 'Xóa thành công',
                                showConfirmButton: true,
                            })
                        }
                        else{
                            swal.fire({
                                icon: 'warning',
                                title: 'Không tồn tại file chứa địa chỉ MAC trên hệ thống',
                                showConfirmButton: true,
                            })
                        }
                    }
                })
            })

            $('.btn-logout').on('click', function(){
                Swal.fire({
                    title : 'Bạn có muốn đăng xuất ?',
                    icon : 'warning',
                    confirmButtonColor: '#17a2b8',
                    confirmButtonText: 'Có, tôi muốn',
                    cancelButtonText: 'Không',
                    cancelButtonColor: 'red',
                    showCancelButton: true,
                    }).then((result) => {
                    if (result.value) {
                        window.location.href = '/logout'
                    }
                })
            })

            $('.btn-change-pass').on('click', function(){
                formChangePass = new FormData(document.getElementById('form_change_pass'))
                $.ajax({
                    url : '{% url "change_pass" %}',
                    type : 'post',
                    data : formChangePass,
                    processData: false,
                    contentType: false,
                    success: function(data){
                        if(data.message_error.length>0){
                            html = data.message_error.join("<br>")
                            $('.alert-error-change-pass').html(html)
                        }
                        else if(data.message_success =='success'){
                            Swal.fire({
                                title: 'Thành công',
                                text: "Bạn đã thay đổi mật khẩu thành công!",
                                icon: 'success',
                                confirmButtonColor: 'green',
                                confirmButtonText: 'Ok'
                                }).then((result) => {
                                if (result.value) {
                                    window.location.href = '/login'
                                }
                            })
                        }
                    }
                })
            })

             $('.waiting-load-page').fadeOut(500, function () {
                $('.roud-waiting-load-page').fadeOut()
            })

        })
    </script>
    <script>
        {#var idleTime = 0;#}
        {#    var timeStart = 0#}
        {#    $(document).on( 'mousemove' , function (event) {#}
        {#        if(document.cookie.indexOf('timeStart=') == -1){#}
        {#            document.cookie = 'timeStart='+ Date.now() + ';path=/';#}
        {#            return false#}
        {#        }#}
        {#        else{#}
        {#            dateStart =  document.cookie.split('timeStart')[1].split('; ')[0].replace('=','')#}
        {#            timeNow = Date.now()#}
        {#            if ((Number(timeNow) - Number(dateStart)) / 1000 > 1800) {#}
        {#                console.log("lớn hơn rồi")#}
        {#                $.ajax({#}
        {#                    url: '/logout',#}
        {#                    type: 'get',#}
        {#                    dataType: 'JSON',#}
        {#                    success: function (data) {#}
        {#                        console.log('ok')#}
        {#                    },#}
        {#                    error: function (data) {#}
        {#                        console.log('error')#}
        {#                    }#}
        {#                })#}
                        {#$("#btn-timeout").text("Ok");#}
                        {#document.getElementById("myModal").style.display = "block";#}
                        {#event.preventDefault()#}
                        {#event.stopImmediatePropagation()#}
                        {#alertSwalTopRight('info', 'LOGOUT')#}
        {#                event.stopImmediatePropagation()#}
        {#            }#}
        {#            else {#}
        {#                document.cookie = 'timeStart='+ Date.now() + ';path=/';#}
        {#            }#}
        {#        }#}
        {#    })#}
    </script>

    {% block add_js %}
    {% endblock %}
</body>
</html>